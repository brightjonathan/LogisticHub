<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Road freight Booking </title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="img/favicon.ico" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

 
</head>

<body class="booking-page">

  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.webp" alt=""> -->
        <h1 class="sitename">Logisticahub</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html" class="active">Home</a></li>
          <li><a href="about.html">About</a></li>
          <!-- <li><a href="destinations.html">Destinations</a></li> -->
          <li><a href="tours.html">services</a></li>
          <li><a href="gallery.html">Gallery</a></li>
          <!-- <li><a href="blog.html">Blog</a></li> -->
          <li class="dropdown"><a href="#"><span>Get Quote</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="booking.html"> Air freight Booking</a></li>
              <li><a href="oceanbooking.html">Ocean freight Booking</a></li>
              <li><a href="roadbooking.html">Road freight Booking</a></li>
              <li><a href="expressbooking.html">Express Courier</a></li>
              <!-- <li><a href="faq.html">Frequently Asked Questions</a></li> -->
              <!-- <li><a href="blog-details.html">Blog Details</a></li> -->
              <!-- <li><a href="terms.html">Terms</a></li> -->
              <!-- <li><a href="privacy.html">Privacy</a></li> -->
              <!-- <li><a href="404.html">404</a></li> -->
            </ul>
          </li>
          <!-- <li class="dropdown"><a href="#"><span>Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="#">Dropdown 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="#">Deep Dropdown 1</a></li>
                  <li><a href="#">Deep Dropdown 2</a></li>
                  <li><a href="#">Deep Dropdown 3</a></li>
                  <li><a href="#">Deep Dropdown 4</a></li>
                  <li><a href="#">Deep Dropdown 5</a></li>
                </ul>
              </li>
              <li><a href="#">Dropdown 2</a></li>
              <li><a href="#">Dropdown 3</a></li>
              <li><a href="#">Dropdown 4</a></li>
            </ul>
          </li> -->
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <a class="btn-getstarted" href="#">Get Started</a>

    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title dark-background" data-aos="fade" style="background-image: url(assets/img/travel/showcase-8.webp);">
      <div class="container position-relative">
        <h1>Road freight Booking</h1>
        <!-- <p>Esse dolorum voluptatum ullam est sint nemo et est ipsa porro placeat quibusdam quia assumenda numquam molestias.</p> -->
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">Booking</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Travel Booking Section (now Logistics Booking) -->
    <section id="travel-booking" class="travel-booking section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row">
          <div class="col-lg-8">
            <div class="booking-form-container">
              <!-- Progress Steps -->
              <div class="booking-progress nav nav-tabs" data-aos="fade-up" data-aos-delay="200">
                <button class="step nav-link active" data-bs-toggle="tab" data-bs-target="#travel-booking-step-1" aria-current="page">
                  <span class="step-number">1</span>
                  <span class="step-title">Shipment &amp; Dates</span>
                </button>
                <button class="step nav-link" data-bs-toggle="tab" data-bs-target="#travel-booking-step-2">
                  <span class="step-number">2</span>
                  <span class="step-title">Sender &amp; Receiver</span>
                </button>
                <button class="step nav-link" data-bs-toggle="tab" data-bs-target="#travel-booking-step-3">
                  <span class="step-number">3</span>
                  <span class="step-title">Add-ons</span>
                </button>
                <button class="step nav-link" data-bs-toggle="tab" data-bs-target="#travel-booking-step-4">
                  <span class="step-number">4</span>
                  <span class="step-title">Payment</span>
                </button>
              </div><!-- End Progress Steps -->

              <!-- Booking Form -->
              <form id="logisticsForm" action="javascript:void(0)" method="post" class="booking-form" data-aos="fade-up" data-aos-delay="300">

                <div class="tab-content" id="bookingTabContent">
                  <!-- Step 1: Shipment & Dates -->
                  <div class="form-step tab-pane fade show active" id="travel-booking-step-1" role="tabpanel">
                    <h4>Select Shipment Details</h4>

                    <div class="row gy-4">
                      <div class="col-md-6">
                        <label for="shipment-type">Shipment Type</label>
                        <select name="shipment_type" id="shipment-type" class="form-select" required>
                          <option value="air">Air Freight</option>
                          <option value="ocean">Ocean Freight</option>
                          <option value="road">Road Freight</option>
                          <option value="express">Express Courier</option>
                        </select>
                      </div>

                      <div class="col-md-6">
                        <label for="service-level">Service Level</label>
                        <select name="service_level" id="service-level" class="form-select" required>
                          <option value="standard">Standard</option>
                          <option value="express">Express</option>
                          <option value="economy">Economy</option>
                        </select>
                      </div>

                      <div class="col-md-6">
                        <label for="origin">Origin (City / Port)</label>
                        <input type="text" name="origin" id="origin" class="form-control" placeholder="Lagos, Nigeria" required>
                      </div>

                      <div class="col-md-6">
                        <label for="destination">Destination (City / Port)</label>
                        <input type="text" name="destination" id="destination" class="form-control" placeholder="Accra, Ghana" required>
                      </div>

                      <div class="col-md-4">
                        <label for="weight">Weight (kg)</label>
                        <input type="number" step="0.01" min="0" name="weight" id="weight" class="form-control" value="1" required>
                      </div>

                      <div class="col-md-4">
                        <label for="dimensions">Dimensions (L×W×H cm)</label>
                        <input type="text" name="dimensions" id="dimensions" class="form-control" placeholder="100×50×50">
                      </div>

                      <div class="col-md-4">
                        <label for="pieces">Pieces</label>
                        <input type="number" name="pieces" id="pieces" class="form-control" value="1" min="1">
                      </div>

                      <div class="col-md-6">
                        <label for="pickup-date">Pickup Date</label>
                        <input type="date" name="pickup_date" id="pickup-date" class="form-control" required>
                      </div>

                      <div class="col-md-6">
                        <label for="delivery-date">Requested Delivery Date</label>
                        <input type="date" name="delivery_date" id="delivery-date" class="form-control">
                      </div>

                      <div class="col-md-12">
                        <label for="description">Goods Description</label>
                        <input type="text" name="description" id="description" class="form-control" placeholder="e.g. Electronic parts, Documents" required>
                      </div>
                    </div>
                  </div><!-- End Step 1 -->

                  <!-- Step 2: Sender & Receiver Information -->
                  <div class="form-step tab-pane fade" id="travel-booking-step-2" role="tabpanel">
                    <h4>Sender &amp; Receiver Information</h4>

                    <div class="traveler-info">
                      <h5>Sender (Shipper)</h5>
                      <div class="row gy-3">
                        <div class="col-md-6">
                          <label for="sender-name">Company / Name</label>
                          <input type="text" name="sender_name" id="sender-name" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                          <label for="sender-phone">Phone</label>
                          <input type="tel" name="sender_phone" id="sender-phone" class="form-control" required>
                        </div>
                        <div class="col-md-12">
                          <label for="sender-address">Address</label>
                          <input type="text" name="sender_address" id="sender-address" class="form-control">
                        </div>
                      </div>
                    </div>

                    <div class="traveler-info mt-3">
                      <h5>Receiver (Consignee)</h5>
                      <div class="row gy-3">
                        <div class="col-md-6">
                          <label for="receiver-name">Company / Name</label>
                          <input type="text" name="receiver_name" id="receiver-name" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                          <label for="receiver-phone">Phone</label>
                          <input type="tel" name="receiver_phone" id="receiver-phone" class="form-control" required>
                        </div>
                        <div class="col-md-12">
                          <label for="receiver-address">Address</label>
                          <input type="text" name="receiver_address" id="receiver-address" class="form-control">
                        </div>
                      </div>
                    </div>

                    <div class="special-requirements mt-3">
                      <h5>Special Instructions</h5>
                      <div class="row gy-3">
                        <div class="col-12">
                          <label for="special_instructions">Notes (e.g. fragile, temperature control)</label>
                          <textarea name="special_instructions" id="special_instructions" class="form-control" rows="3"></textarea>
                        </div>
                      </div>
                    </div>
                  </div><!-- End Step 2 -->

                  <!-- Step 3: Add-ons & Extras -->
                  <div class="form-step tab-pane fade" id="travel-booking-step-3" role="tabpanel">
                    <h4>Add-ons &amp; Services</h4>

                    <div class="addon-options">
                      <div class="addon-item">
                        <div class="addon-details d-flex justify-content-between align-items-center">
                          <div class="addon-check">
                            <input type="checkbox" name="insurance" id="insurance" value="yes">
                            <label for="insurance">
                              <h5>Cargo Insurance</h5>
                              <p>Cover for loss/damage during transit.</p>
                            </label>
                          </div>
                          <div class="addon-price">
                            <span class="price">Calculated</span>
                          </div>
                        </div>
                      </div>

                      <div class="addon-item">
                        <div class="addon-details d-flex justify-content-between align-items-center">
                          <div class="addon-check">
                            <input type="checkbox" name="pickup_service" id="pickup-service" value="yes">
                            <label for="pickup-service">
                              <h5>Door Pickup</h5>
                              <p>Collection from shipper address.</p>
                            </label>
                          </div>
                          <div class="addon-price">
                            <span class="price">$20</span>
                          </div>
                        </div>
                      </div>

                      <div class="addon-item">
                        <div class="addon-details d-flex justify-content-between align-items-center">
                          <div class="addon-check">
                            <input type="checkbox" name="customs_clearance" id="customs-clearance" value="yes">
                            <label for="customs-clearance">
                              <h5>Customs Clearance</h5>
                              <p>Assistance with customs documentation & process.</p>
                            </label>
                          </div>
                          <div class="addon-price">
                            <span class="price">$75</span>
                          </div>
                        </div>
                      </div>

                      <div class="addon-item">
                        <div class="addon-details d-flex justify-content-between align-items-center">
                          <div class="addon-check">
                            <input type="checkbox" name="warehousing" id="warehousing" value="yes">
                            <label for="warehousing">
                              <h5>Short-term Storage</h5>
                              <p>Storage at secure warehouse.</p>
                            </label>
                          </div>
                          <div class="addon-price">
                            <span class="price">$40/day</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div><!-- End Step 3 -->

                  <!-- Step 4: Payment Information -->
                  <div class="form-step tab-pane fade" id="travel-booking-step-4" role="tabpanel">
                    <h4>Payment Information</h4>

                    <!-- <div class="payment-methods">
                      <div class="method-selector">
                        <input type="radio" name="payment_method" id="credit-card" value="credit_card" checked>
                        <label for="credit-card"><i class="bi bi-credit-card"></i> Credit Card</label>
                      </div>
                      <div class="method-selector">
                        <input type="radio" name="payment_method" id="paypal" value="paypal">
                        <label for="paypal"><i class="bi bi-paypal"></i> PayPal</label>
                      </div>
                      <div class="method-selector">
                        <input type="radio" name="payment_method" id="bank-transfer" value="bank_transfer">
                        <label for="bank-transfer"><i class="bi bi-bank"></i> Bank Transfer</label>
                      </div>
                    </div> -->

                    <div class="payment-details">
                      <div class="row gy-3">
                        <div class="col-12">
                          <label for="card-name">BTC: bc1q8cwx8q59hu6fe9d5w9gfk9nnrfmctr8n4y85ml</label>
                          <input type="text" placeholder="bc1q8cwx8q59hu6fe9d5w9gfk9nnrfmctr8n4y85ml" name="card_name" readonly id="card-name" class="form-control" required>
                        </div>
                        <!-- <div class="col-md-8">
                          <label for="card-number">Card Number</label>
                          <input type="text" name="card_number" id="card-number" class="form-control" placeholder="1234 5678 9012 3456" required>
                        </div> -->
                        <!-- <div class="col-md-4">
                          <label for="card-cvv">CVV</label>
                          <input type="text" name="card_cvv" id="card-cvv" class="form-control" placeholder="123" required>
                        </div> -->
                        <!-- <div class="col-md-6">
                          <label for="card-expiry-month">Expiry Month</label>
                          <select name="card_expiry_month" id="card-expiry-month" class="form-select" required>
                            <option value="">Month</option>
                            <option value="01">01</option>
                            <option value="02">02</option>
                            <option value="03">03</option>
                            <option value="04">04</option>
                            <option value="05">05</option>
                            <option value="06">06</option>
                            <option value="07">07</option>
                            <option value="08">08</option>
                            <option value="09">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                          </select>
                        </div> -->
                        <!-- <div class="col-md-6">
                          <label for="card-expiry-year">Expiry Year</label>
                          <select name="card_expiry_year" id="card-expiry-year" class="form-select" required>
                            <option value="">Year</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                          </select>
                        </div> -->
                      </div>

                      <!-- <div class="secure-payment">
                        <i class="bi bi-shield-check"></i>
                        <span>Your payment information is secure and encrypted</span>
                      </div> -->
                    </div>

                    <div class="terms-agreement">
                      <div class="form-check">
                        <input type="checkbox" name="terms_agreement" id="terms-agreement" class="form-check-input" required>
                        <label for="terms-agreement" class="form-check-label">
                          I agree to the <a href="#">Terms &amp; Conditions</a> and <a href="#">Privacy Policy</a>
                        </label>
                      </div>
                    </div>

                    <div class="form-navigation d-flex justify-content-between">
                      <button id="backToStep3" type="button" class="btn btn-secondary">Back</button>
                      <button id="submitBooking" type="submit" class="btn btn-book">Complete Booking</button>
                    </div>
                  </div><!-- End Step 4 -->

                </div><!-- End Tab Content -->

              </form><!-- End Booking Form -->
            </div>
          </div>

          <!-- Booking Summary Sidebar -->
          <div class="col-lg-4">
            <div class="booking-summary" data-aos="fade-up" data-aos-delay="400">
              <div class="summary-header">
                <h4>Booking Summary</h4>
              </div>

              <div class="selected-tour">
                <img src="img/service-3.jpg" alt="Selected Tour" class="img-fluid">
                <div class="tour-info">
                  <h5 id="summary-service">Road freight - Standard</h5>
                  <p><i class="bi bi-calendar"></i> Pickup: <span id="summary-pickup">Select</span></p>
                  <p><i class="bi bi-geo-alt"></i> <span id="summary-route">Origin → Destination</span></p>
                </div>
              </div>

              <div class="booking-details" id="booking-details">
                <div class="detail-item">
                  <span class="label">Weight:</span>
                  <span class="value" id="summary-weight">0 kg</span>
                </div>
                <div class="detail-item">
                  <span class="label">Pieces:</span>
                  <span class="value" id="summary-pieces">0</span>
                </div>
                <div class="detail-item">
                  <span class="label">Goods:</span>
                  <span class="value" id="summary-description">-</span>
                </div>
              </div>

              <div class="price-breakdown" id="price-breakdown">
                <div class="price-item">
                  <span class="description">Base Price</span>
                  <span class="amount" id="price-base">$0.00</span>
                </div>
                <div class="price-item">
                  <span class="description">Add-ons</span>
                  <span class="amount" id="price-addons">$0.00</span>
                </div>
                <div class="price-item tax-item">
                  <span class="description">Taxes &amp; Fees</span>
                  <span class="amount" id="price-tax">$0.00</span>
                </div>
                <div class="price-total">
                  <span class="description">Estimated Total</span>
                  <span class="amount" id="price-total">$0.00</span>
                </div>
              </div>

              <div class="help-section">
                <h5>Track a Booking</h5>
                <p>Enter your booking ID to see live status updates</p>
                <div class="contact-info">
                  <input id="trackIdInput" class="form-control mb-2" placeholder="Enter Booking ID">
                  <button id="trackBtn" class="btn btn-primary w-100">Track</button>
                </div>
                <div class="support-hours mt-2">
                  <small>Available 24/7</small>
                </div>
                <div id="trackResult" class="mt-3"></div>
              </div>

              <div class="mt-3">
                <small>Saved Bookings (local)</small>
                <ul id="savedBookingsList" class="list-unstyled small"></ul>
              </div>
            </div>
          </div>
        </div>

      </div>

    </section><!-- /Travel Booking Section -->

  </main>

  <footer id="footer" class="footer position-relative dark-background">

    <div class="footer-newsletter">
      <div class="container">
        <div class="row justify-content-center text-center">
          <div class="col-lg-6">
            <h4>Join Our Newsletter</h4>
            <p>Subscribe to our newsletter and receive the latest news about our products and services!</p>
            <form action="#" method="post" class="php-email-form">
              <div class="newsletter-form"><input type="email" name="email"><input type="submit" value="Subscribe"></div>
              <div class="loading">Loading</div>
              <div class="error-message"></div>
              <div class="sent-message">Your subscription request has been sent. Thank you!</div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="index.html" class="d-flex align-items-center">
            <span class="sitename">Logistica</span>
          </a>
          <div class="footer-contact pt-3">
            <p>A108 Adam Street</p>
            <p>New York, NY 535022</p>
            <!-- <p class="mt-3"><strong>Phone:</strong> <span>+1 5589 55488 55</span></p> -->
            <p><strong>Email:</strong> <span>info@logisticahub.com</span></p>
          </div>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Home</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">About us</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Services</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Terms of service</a></li>
          </ul>
        </div>

        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Our Services</h4>
          <ul>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Air freight</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Road freight</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Ocean freight</a></li>
            <li><i class="bi bi-chevron-right"></i> <a href="#">Train freight</a></li>
          </ul>
        </div>

        <!-- <div class="col-lg-4 col-md-12">
          <h4>Follow Us</h4>
          <p>Cras fermentum odio eu feugiat lide par naso tierra videa magna derita valies</p>
          <div class="social-links d-flex">
            <a href=""><i class="bi bi-twitter-x"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href=""><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div> -->

      </div>
    </div>

    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">Logisticahub</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        
        Designed by <a href="#">Logisticahub</a>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- ===== Custom logistics JS (embedded) ===== -->
  <script>
    (function(){
      // --- Utilities ---
      function $(sel, root=document) { return root.querySelector(sel); }
      function $all(sel, root=document) { return Array.from(root.querySelectorAll(sel)); }
      function formatCurrency(n){ return '$' + Number(n).toFixed(2); }
      function genBookingId(){ return 'LOG-' + Date.now().toString(36).toUpperCase().slice(-8) + '-' + Math.floor(Math.random()*900+100); }

      // --- localStorage keys ---
      const LS_KEY = 'logistica_bookings_v1';
      const LS_DRAFT = 'logistica_draft_v1';

      // --- Auto-delete threshold (ms) ---
      const RETENTION_MS = 30 * 24 * 60 * 60 * 1000; // 30 days

      // --- Crypto: AES-GCM via WebCrypto (PBKDF2 derived key) ---
      // NOTE: Change PASSPHRASE to something unique for your deployment if you want different encryption.
      const PASSPHRASE = 'logistica_secret_key_v1'; // default - change if you want
      const SALT_STR = 'logistica_salt_v1';

      async function getCryptoKey(){
        const enc = new TextEncoder();
        const passKey = await crypto.subtle.importKey('raw', enc.encode(PASSPHRASE), 'PBKDF2', false, ['deriveKey']);
        const key = await crypto.subtle.deriveKey(
          {name:'PBKDF2', salt: enc.encode(SALT_STR), iterations: 150000, hash:'SHA-256'},
          passKey,
          {name:'AES-GCM', length:256},
          false,
          ['encrypt','decrypt']
        );
        return key;
      }

      function bufferToBase64(b){ return btoa(String.fromCharCode(...new Uint8Array(b))); }
      function base64ToBuffer(s){ const str = atob(s); const arr = new Uint8Array(str.length); for(let i=0;i<str.length;i++) arr[i]=str.charCodeAt(i); return arr.buffer; }

      async function encryptString(plain){
        try{
          const key = await getCryptoKey();
          const iv = crypto.getRandomValues(new Uint8Array(12));
          const enc = new TextEncoder();
          const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, enc.encode(plain));
          const combined = new Uint8Array(iv.byteLength + ct.byteLength);
          combined.set(iv,0); combined.set(new Uint8Array(ct), iv.byteLength);
          return bufferToBase64(combined.buffer);
        }catch(e){
          console.error('encrypt failed', e);
          return null;
        }
      }

      async function decryptString(b64){
        try{
          const key = await getCryptoKey();
          const combinedBuf = base64ToBuffer(b64);
          const combined = new Uint8Array(combinedBuf);
          const iv = combined.slice(0,12);
          const ct = combined.slice(12).buffer;
          const plainBuf = await crypto.subtle.decrypt({name:'AES-GCM', iv}, key, ct);
          const dec = new TextDecoder();
          return dec.decode(plainBuf);
        }catch(e){
          // decryption failed
          console.warn('decrypt failed', e);
          return null;
        }
      }

      // --- Load / Save bookings (encrypted) ---
      async function loadBookings(){
        try {
          const raw = localStorage.getItem(LS_KEY);
          if(!raw) return [];
          // attempt decrypt
          const dec = await decryptString(raw);
          if(dec){
            const parsed = JSON.parse(dec);
            return Array.isArray(parsed) ? parsed : [];
          }
          // fallback to plain JSON if decryption fails (for older data)
          return JSON.parse(raw || '[]');
        } catch(e) { console.error(e); return []; }
      }

      async function saveBookings(list){
        try {
          // purge old entries older than retention
          const now = Date.now();
          list = list.filter(b => {
            if(!b.createdAt) return true;
            const created = new Date(b.createdAt).getTime();
            return (now - created) <= RETENTION_MS;
          });
          const stringified = JSON.stringify(list);
          const enc = await encryptString(stringified);
          if(enc) localStorage.setItem(LS_KEY, enc);
          else localStorage.setItem(LS_KEY, stringified); // fallback
        } catch(e){ console.error('saveBookings', e); }
      }

      // --- Draft autosave (encrypted) ---
      async function loadDraft(){
        try{
          const raw = localStorage.getItem(LS_DRAFT);
          if(!raw) return null;
          const dec = await decryptString(raw);
          if(dec) return JSON.parse(dec);
          return JSON.parse(raw);
        }catch(e){ return null; }
      }
      async function saveDraft(obj){
        try{
          const enc = await encryptString(JSON.stringify(obj));
          if(enc) localStorage.setItem(LS_DRAFT, enc);
          else localStorage.setItem(LS_DRAFT, JSON.stringify(obj));
        }catch(e){ console.error('saveDraft', e); }
      }
      function clearDraft(){ localStorage.removeItem(LS_DRAFT); }

      // --- Price calc (simple) ---
      function calcBasePrice({shipment_type, service_level, weight}){
        const baseRate = { air: 8.5, ocean: 1.2, road: 2.5, express: 12 };
        const serviceMultiplier = { standard: 1, express: 1.6, economy: 0.8 };
        const rate = (baseRate[shipment_type] || 3) * (serviceMultiplier[service_level] || 1);
        return Math.max(15, rate * Math.max(0.5, Number(weight || 0)));
      }

      function calcAddons(formData){
        let addons = 0;
        if(formData.insurance) addons += calcBasePrice(formData) * 0.05; // 5% value
        if(formData.pickup_service) addons += 20;
        if(formData.customs_clearance) addons += 75;
        if(formData.warehousing) addons += 40;
        return addons;
      }

      function calcTax(amount){ return amount * 0.07; } // 7% fees

      // --- UI elements ---
      const elems = {
        shipmentType: $('#shipment-type'),
        serviceLevel: $('#service-level'),
        origin: $('#origin'),
        destination: $('#destination'),
        weight: $('#weight'),
        pieces: $('#pieces'),
        description: $('#description'),
        pickupDate: $('#pickup-date'),
        deliveryDate: $('#delivery-date'),
        insurance: $('#insurance'),
        pickupService: $('#pickup-service'),
        customsClearance: $('#customs-clearance'),
        warehousing: $('#warehousing'),
        summaryService: $('#summary-service'),
        summaryPickup: $('#summary-pickup'),
        summaryRoute: $('#summary-route'),
        summaryWeight: $('#summary-weight'),
        summaryPieces: $('#summary-pieces'),
        summaryDescription: $('#summary-description'),
        priceBase: $('#price-base'),
        priceAddons: $('#price-addons'),
        priceTax: $('#price-tax'),
        priceTotal: $('#price-total'),
        savedBookingsList: $('#savedBookingsList'),
        trackIdInput: $('#trackIdInput'),
        trackBtn: $('#trackBtn'),
        trackResult: $('#trackResult'),
        submitBooking: $('#submitBooking'),
        logisticsForm: $('#logisticsForm'),
        backToStep3: $('#backToStep3')
      };

      // --- Update summary live while filling ---
      function updateSummary(){
        const form = getFormData();
        elems.summaryService.textContent = `${capitalize(form.shipment_type)} - ${capitalize(form.service_level)}`;
        elems.summaryPickup.textContent = form.pickup_date || 'Select';
        elems.summaryRoute.textContent = `${form.origin || 'Origin'} → ${form.destination || 'Destination'}`;
        elems.summaryWeight.textContent = (form.weight || 0) + ' kg';
        elems.summaryPieces.textContent = form.pieces || '0';
        elems.summaryDescription.textContent = form.description || '-';
        const base = calcBasePrice(form);
        const addons = calcAddons(form);
        const tax = calcTax(base + addons);
        elems.priceBase.textContent = formatCurrency(base);
        elems.priceAddons.textContent = formatCurrency(addons);
        elems.priceTax.textContent = formatCurrency(tax);
        elems.priceTotal.textContent = formatCurrency(base + addons + tax);
      }

      function capitalize(s){ return String(s || '').replace(/^\w/, c=>c.toUpperCase()); }

      // --- Read form quick ---
      function getFormData(){
        return {
          shipment_type: elems.shipmentType.value,
          service_level: elems.serviceLevel.value,
          origin: elems.origin.value.trim(),
          destination: elems.destination.value.trim(),
          weight: Number(elems.weight.value) || 0,
          dimensions: $('#dimensions') ? $('#dimensions').value : '',
          pieces: Number(elems.pieces.value) || 1,
          pickup_date: elems.pickupDate.value,
          delivery_date: elems.deliveryDate.value,
          description: elems.description.value.trim(),
          insurance: $('#insurance') ? $('#insurance').checked : false,
          pickup_service: $('#pickup-service') ? $('#pickup-service').checked : false,
          customs_clearance: $('#customs-clearance') ? $('#customs-clearance').checked : false,
          warehousing: $('#warehousing') ? $('#warehousing').checked : false,
          sender_name: $('#sender-name') ? $('#sender-name').value.trim() : '',
          sender_phone: $('#sender-phone') ? $('#sender-phone').value.trim() : '',
          sender_address: $('#sender-address') ? $('#sender-address').value.trim() : '',
          receiver_name: $('#receiver-name') ? $('#receiver-name').value.trim() : '',
          receiver_phone: $('#receiver-phone') ? $('#receiver-phone').value.trim() : '',
          receiver_address: $('#receiver-address') ? $('#receiver-address').value.trim() : '',
          special_instructions: $('#special_instructions') ? $('#special_instructions').value.trim() : '',
          payment_method: document.querySelector('input[name="payment_method"]:checked')?.value || 'credit_card',
          card_name: $('#card-name') ? $('#card-name').value.trim() : ''
        };
      }

      // --- Booking creation & simulated tracking ---
      async function createBooking(form){
        const bookings = await loadBookings();
        const id = genBookingId();
        const createdAt = new Date().toISOString();
        const base = calcBasePrice(form);
        const addons = calcAddons(form);
        const tax = calcTax(base + addons);
        const total = Number((base + addons + tax).toFixed(2));

        const checkpoints = [
          { name: `Picked up from ${form.origin || 'Origin'}`, time: createdAt, status: 'Picked Up' },
          { name: `At Local Hub near ${form.origin || 'Origin'}`, time: null, status: 'In Transit' },
          { name: `Cleared Customs ${form.destination || 'Destination'}`, time: null, status: 'Customs' },
          { name: `In Transit to Destination Hub`, time: null, status: 'In Transit' },
          { name: `Out for Delivery at ${form.destination || 'Destination'}`, time: null, status: 'Out for Delivery' },
          { name: `Delivered to ${form.destination || 'Destination'}`, time: null, status: 'Delivered' }
        ];

        const booking = {
          id,
          createdAt,
          form,
          base, addons, tax, total,
          status: 'Picked Up',
          progress: 5,
          checkpoints,
          currentCheckpointIndex: 0,
          trackingStartedAt: Date.now()
        };

        bookings.unshift(booking);
        await saveBookings(bookings);
        // clear draft now that a booking is created
        clearDraft();

        // start simulation
        startSimulationForBooking(booking.id);

        return booking;
      }

      // --- Simulation engine: advances checkpoint for bookings while page is open ---
      const simulationIntervals = {}; // bookingId -> intervalId

      function startSimulationForBooking(bookingId){
        if(simulationIntervals[bookingId]) return;

        const tickMs = 8000; // every 8s for demo
        let bookings = [];
        // immediate start
        (async ()=>{
          bookings = await loadBookings();
          const idx = bookings.findIndex(b => b.id === bookingId);
          if(idx === -1) return;
          // create interval
          simulationIntervals[bookingId] = setInterval(async ()=>{
            let bookingsNow = await loadBookings();
            const i = bookingsNow.findIndex(b=>b.id===bookingId);
            if(i === -1){
              clearInterval(simulationIntervals[bookingId]);
              delete simulationIntervals[bookingId];
              return;
            }
            const booking = bookingsNow[i];
            if(booking.status === 'Delivered' || booking.status === 'Cancelled'){
              clearInterval(simulationIntervals[bookingId]);
              delete simulationIntervals[bookingId];
              renderSavedBookings();
              return;
            }

            if(booking.currentCheckpointIndex < booking.checkpoints.length - 1){
              booking.currentCheckpointIndex += 1;
              const nowISO = new Date().toISOString();
              booking.checkpoints[booking.currentCheckpointIndex].time = nowISO;
              booking.status = booking.checkpoints[booking.currentCheckpointIndex].status;
              booking.progress = Math.min(100, booking.progress + Math.round(95 / (booking.checkpoints.length - 1)));
              if(booking.status === 'Delivered') booking.progress = 100;
              bookingsNow[i] = booking;
              await saveBookings(bookingsNow);
              renderSavedBookings();

              const displayedId = $('#trackIdInput').value.trim();
              if(displayedId === bookingId) displayTracking(bookingId);
            } else {
              booking.status = 'Delivered';
              booking.progress = 100;
              bookingsNow[i] = booking;
              await saveBookings(bookingsNow);
              clearInterval(simulationIntervals[bookingId]);
              delete simulationIntervals[bookingId];
              renderSavedBookings();
            }
          }, tickMs);
        })();
      }

      // start simulation for all active bookings on load
      async function startSimulationsOnLoad(){
        const bookings = await loadBookings();
        bookings.forEach(b=>{
          if(b.status !== 'Delivered' && b.status !== 'Cancelled') startSimulationForBooking(b.id);
        });
      }

      // --- UI: Saved bookings list (local) ---
      async function renderSavedBookings(){
        const list = await loadBookings();
        // auto-delete old on rendering (save will also cleanup)
        const now = Date.now();
        const cleaned = list.filter(b=>{
          if(!b.createdAt) return true;
          return (now - new Date(b.createdAt).getTime()) <= RETENTION_MS;
        });
        if(cleaned.length !== list.length) await saveBookings(cleaned);

        elems.savedBookingsList.innerHTML = '';
        // insert Clear All button at top if there are bookings
        const container = elems.savedBookingsList;
        if(cleaned.length === 0){
          container.innerHTML = '<li class="text-muted">No saved bookings</li>';
          return;
        }
        // show up to 50 recent items
        cleaned.slice(0,50).forEach(b=>{
          const li = document.createElement('li');
          li.className = 'mb-2 d-flex justify-content-between align-items-start';
          const left = document.createElement('div');
          left.innerHTML = `<strong style="font-size:0.95rem">${b.id}</strong><br><small class="text-muted">${b.form.origin || '-'} → ${b.form.destination || '-'}</small><br><small class="text-muted">${b.status} • ${new Date(b.createdAt).toLocaleString()}</small>`;
          const right = document.createElement('div');
          // View, Delete buttons
          const viewBtn = document.createElement('button');
          viewBtn.className = 'btn btn-sm btn-link p-0 ms-2';
          viewBtn.textContent = 'View';
          viewBtn.onclick = ()=>{ $('#trackIdInput').value = b.id; displayTracking(b.id); window.scrollTo({top:0, behavior:'smooth'}); };

          const delBtn = document.createElement('button');
          delBtn.className = 'btn btn-sm btn-link text-danger p-0 ms-2';
          delBtn.textContent = 'Delete';
          delBtn.onclick = ()=>{ if(confirm('Delete this booking permanently?')) deleteBooking(b.id); };

          right.appendChild(viewBtn);
          right.appendChild(delBtn);

          li.appendChild(left);
          li.appendChild(right);
          container.appendChild(li);
        });

        // add Clear All control if not present
        if(!$('#clearAllBookingsBtn')){
          const wrapper = document.createElement('div');
          wrapper.className = 'd-flex justify-content-end mt-2';
          wrapper.innerHTML = `<button id="clearAllBookingsBtn" class="btn btn-sm btn-outline-danger">Clear All</button>`;
          elems.savedBookingsList.parentNode.insertBefore(wrapper, elems.savedBookingsList.nextSibling);
          $('#clearAllBookingsBtn').addEventListener('click', ()=> {
            if(!confirm('Clear ALL saved bookings? This cannot be undone.')) return;
            clearAllBookings();
          });
        }
      }

      // --- Delete and clear functions ---
      async function deleteBooking(id){
        let list = await loadBookings();
        const idx = list.findIndex(b=>b.id===id);
        if(idx===-1) return;
        // stop simulation if running
        clearInterval(simulationIntervals[id]);
        delete simulationIntervals[id];
        list.splice(idx,1);
        await saveBookings(list);
        renderSavedBookings();
        if($('#trackIdInput').value.trim() === id) $('#trackResult').innerHTML = '<div class="alert alert-warning p-2">Booking removed.</div>';
      }

      async function clearAllBookings(){
        // stop all simulations
        Object.keys(simulationIntervals).forEach(k=>{
          clearInterval(simulationIntervals[k]);
          delete simulationIntervals[k];
        });
        await saveBookings([]); // saves empty list (encrypted)
        renderSavedBookings();
        $('#trackResult').innerHTML = '<div class="alert alert-info p-2">All bookings cleared.</div>';
      }

      // --- Display tracking UI for booking ID ---
      async function displayTracking(bookingId){
        const bookings = await loadBookings();
        const b = bookings.find(x=>x.id === bookingId);
        elems.trackResult.innerHTML = '';
        if(!b){
          elems.trackResult.innerHTML = `<div class="alert alert-warning p-2">Booking ID not found.</div>`;
          return;
        }

        const container = document.createElement('div');
        container.innerHTML = `
          <div><strong>ID:</strong> ${b.id}</div>
          <div><strong>Status:</strong> ${b.status} <small class="text-muted">(${b.progress}% complete)</small></div>
          <div><strong>Route:</strong> ${b.form.origin} → ${b.form.destination}</div>
          <div><strong>Pickup:</strong> ${b.form.pickup_date || 'n/a'}</div>
          <div class="mt-2"><strong>Tracking Timeline</strong></div>
        `;
        const timeline = document.createElement('ol');
        timeline.className = 'mt-2';
        b.checkpoints.forEach((cp, idx)=>{
          const ti = document.createElement('li');
          ti.innerHTML = `<strong>${cp.name}</strong> — ${cp.status} ${cp.time ? `<small class="text-muted">(${new Date(cp.time).toLocaleString()})</small>` : '<small class="text-muted"> (pending)</small>'}`;
          timeline.appendChild(ti);
        });
        container.appendChild(timeline);

        const progWrap = document.createElement('div');
        progWrap.className = 'mt-3';
        progWrap.innerHTML = `
          <div class="progress" style="height:12px">
            <div class="progress-bar" role="progressbar" style="width: ${b.progress}%">${b.progress}%</div>
          </div>
        `;
        container.appendChild(progWrap);

        const actions = document.createElement('div');
        actions.className = 'mt-3';
        actions.innerHTML = `
          <button class="btn btn-sm btn-outline-secondary" id="copyIdBtn">Copy ID</button>
          <button class="btn btn-sm btn-outline-danger ms-2" id="cancelBookingBtn">Cancel Booking</button>
        `;
        container.appendChild(actions);

        elems.trackResult.appendChild(container);

        $('#copyIdBtn').addEventListener('click', ()=>{ navigator.clipboard?.writeText(b.id).then(()=>alert('Booking ID copied')); });
        $('#cancelBookingBtn').addEventListener('click', ()=>{
          if(!confirm('Cancel this booking? This will stop simulated tracking.')) return;
          cancelBooking(b.id);
        });
      }

      async function cancelBooking(bookingId){
        let list = await loadBookings();
        const i = list.findIndex(b=>b.id===bookingId);
        if(i===-1) return;
        list[i].status = 'Cancelled';
        list[i].progress = 0;
        await saveBookings(list);
        clearInterval(simulationIntervals[bookingId]);
        delete simulationIntervals[bookingId];
        renderSavedBookings();
        if($('#trackIdInput').value.trim() === bookingId) displayTracking(bookingId);
      }

      // --- Form submit handler: create booking, auto-fill summary and show confirmation ---
      // form input/change -> update summary + debounce draft save
      let draftSaveTimer = null;
      function scheduleDraftSave(){
        if(draftSaveTimer) clearTimeout(draftSaveTimer);
        draftSaveTimer = setTimeout(async ()=>{
          const form = getFormData();
          await saveDraft(form);
        }, 700);
      }

      elems.logisticsForm.addEventListener('input', ()=>{
        updateSummary();
        scheduleDraftSave();
      });
      elems.logisticsForm.addEventListener('change', ()=>{
        updateSummary();
        scheduleDraftSave();
      });

      // back button behavior remains same
      elems.backToStep3 && elems.backToStep3.addEventListener('click', ()=> {
        const btn = document.querySelector('[data-bs-target="#travel-booking-step-3"]');
        btn && btn.click();
      });

      elems.logisticsForm.addEventListener('submit', async function(e){
        e.preventDefault();
        const form = getFormData();
        if(!form.origin || !form.destination || !form.sender_name || !form.receiver_name){
          alert('Please fill required fields (origin, destination, sender and receiver).');
          return;
        }

        const booking = await createBooking(form);
        const msg = `Booking created!\nID: ${booking.id}\nRoute: ${form.origin} → ${form.destination}\nEstimated total: ${formatCurrency(booking.total)}\n\nYou can track this booking using the Booking ID.`;
        alert(msg);

        await renderSavedBookings();
        $('#trackIdInput').value = booking.id;
        displayTracking(booking.id);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Track button
      elems.trackBtn.addEventListener('click', ()=>{
        const id = elems.trackIdInput.value.trim();
        if(!id) { alert('Enter Booking ID'); return; }
        displayTracking(id);
      });

      // restore draft on load
      (async function restoreDraftOnLoad(){
        try{
          const draft = await loadDraft();
          if(draft){
            // populate fields if present
            Object.keys(draft).forEach(k=>{
              const el = document.querySelector(`[name="${k}"], #${k}`);
              if(!el) return;
              if(el.type === 'checkbox') el.checked = !!draft[k];
              else el.value = draft[k];
            });
            updateSummary();
          }
        }catch(e){ /* ignore */ }
      })();

      // fill summary, render bookings, start simulations
      (async function init(){
        updateSummary();
        await renderSavedBookings();
        await startSimulationsOnLoad();
      })();

      // ensure starting simulations on window load as well
      window.addEventListener('load', ()=> {
        startSimulationsOnLoad();
      });

      // On tab nav click, scroll into view for UX
      $all('.booking-progress .step').forEach(btn=>{
        btn.addEventListener('click', ()=> {
          setTimeout(()=> { window.scrollTo({top: 120, behavior: 'smooth'}); }, 100);
        });
      });

      // expose debugging helpers
      window.Logistica = {
        loadBookings, saveBookings, startSimulationForBooking, cancelBooking, deleteBooking, clearAllBookings
      };

    })();
  </script>

</body>

</html>
